<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>To-Do App V1.2 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen p-4 md:p-6">
    <div class="max-w-7xl mx-auto overflow-hidden">
      <header class="text-center mb-8">
        <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Professional To-Do Manager</h1>
        <p class="text-slate-600 mt-2">V1.2 Pro â€¢ Advanced Task Management with Priorities, Due Dates & Categories</p>
      </header>

      <div class="grid lg:grid-cols-12 gap-6">
        <!-- Add Task Panel - Made larger -->
        <div class="lg:col-span-4">
          <div class="bg-white rounded-xl shadow-lg p-6 border border-slate-200">
            <h2 class="text-xl font-semibold text-slate-800 mb-6 flex items-center">
              <span class="bg-blue-100 text-blue-600 rounded-full p-2 mr-3">â•</span>
              Add New Task
            </h2>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Task Title</label>
                <input id="newTask" type="text" placeholder="What needs to be done?" 
                       class="w-full border border-slate-300 rounded-lg px-4 py-3 text-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" />
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2">Priority Level</label>
                  <select id="newPriority" class="w-full border border-slate-300 rounded-lg px-3 py-3 text-base focus:ring-2 focus:ring-blue-500">
                    <option value="low">ğŸŸ¢ Low Priority</option>
                    <option value="medium" selected>ğŸŸ¡ Medium Priority</option>
                    <option value="high">ğŸ”´ High Priority</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2">Due Date</label>
                  <input id="newDueDate" type="date" 
                         class="w-full border border-slate-300 rounded-lg px-3 py-3 focus:ring-2 focus:ring-blue-500" />
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Category</label>
                <select id="newCategory" class="w-full border border-slate-300 rounded-lg px-3 py-3 text-base focus:ring-2 focus:ring-blue-500">
                  <option value="personal">ğŸ‘¤ Personal</option>
                  <option value="work">ğŸ’¼ Work</option>
                  <option value="learning">ğŸ“š Learning</option>
                  <option value="health">ğŸ’ª Health</option>
                  <option value="shopping">ğŸ›’ Shopping</option>
                  <option value="general">ğŸ“‹ General</option>
                </select>
              </div>
              
              <button id="addBtn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg">
                â• Add Task
              </button>
            </div>
          </div>
        </div>

        <!-- Tasks Panel - Adjusted to take remaining space -->
        <div class="lg:col-span-8">
          <!-- Filters -->
          <div class="bg-white rounded-xl shadow-lg p-4 mb-6 border border-slate-200">
            <div class="flex flex-wrap gap-3 items-center">
              <input id="searchTask" type="text" placeholder="ğŸ” Search tasks..." class="flex-1 min-w-0 border border-slate-300 rounded-lg px-3 py-2" />
              <select id="filterPriority" class="border border-slate-300 rounded-lg px-3 py-2 min-w-0">
                <option value="">All Priorities</option>
                <option value="high">ğŸ”´ High</option>
                <option value="medium">ğŸŸ¡ Medium</option>
                <option value="low">ğŸŸ¢ Low</option>
              </select>
              <select id="filterCategory" class="border border-slate-300 rounded-lg px-3 py-2 min-w-0">
                <option value="">All Categories</option>
                <option value="personal">ğŸ‘¤ Personal</option>
                <option value="work">ğŸ’¼ Work</option>
                <option value="learning">ğŸ“š Learning</option>
                <option value="health">ğŸ’ª Health</option>
                <option value="shopping">ğŸ›’ Shopping</option>
                <option value="general">ğŸ“‹ General</option>
              </select>
            </div>
          </div>
          
          <!-- Task Stats -->
          <div id="taskStats" class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-4 mb-6 border border-slate-200"></div>

          <!-- Tasks List -->
          <div id="tasks" class="space-y-3 overflow-hidden">Loading tasks...</div>
        </div>
      </div>

      <footer class="text-center mt-8 text-sm text-slate-500">
        <div class="bg-white rounded-lg p-4 shadow-sm border border-slate-200">
          <strong>V1.2 Pro</strong> â€¢ Professional Task Management â€¢ Features: Priorities, Due Dates, Categories, Search & Filter
        </div>
      </footer>
    </div>

    <script>
      let allTasks = [];
      let filteredTasks = [];

      function getPriorityIcon(priority) {
        return priority === 'high' ? 'ğŸ”´' : priority === 'medium' ? 'ğŸŸ¡' : 'ğŸŸ¢';
      }

      function getCategoryIcon(category) {
        const icons = { personal: 'ğŸ‘¤', work: 'ğŸ’¼', learning: 'ğŸ“š', health: 'ğŸ’ª', shopping: 'ğŸ›’' };
        return icons[category] || 'ğŸ“‹';
      }

      function formatDate(dateStr) {
        if (!dateStr) return '';
        const date = new Date(dateStr);
        const today = new Date();
        const diffDays = Math.ceil((date - today) / (1000 * 60 * 60 * 24));
        
        if (diffDays < 0) return '<span class="text-red-600 font-bold">Overdue</span>';
        if (diffDays === 0) return '<span class="text-orange-600 font-bold">Today</span>';
        if (diffDays === 1) return '<span class="text-yellow-600">Tomorrow</span>';
        return `<span class="text-slate-600">${date.toLocaleDateString()}</span>`;
      }

      function taskHtml(t) {
        const priorityColors = {
          high: 'border-l-red-500 bg-red-50',
          medium: 'border-l-orange-500 bg-orange-50', 
          low: 'border-l-green-500 bg-green-50'
        };
        
        return `
          <div class="bg-white rounded-xl shadow-sm border-l-4 ${priorityColors[t.priority]} p-4 hover:shadow-md transition-all" data-id="${t.id}">
            <div class="flex items-start justify-between">
              <div class="flex items-start gap-3 flex-1">
                <input type="checkbox" class="cb h-5 w-5 text-blue-600 rounded mt-1" ${t.completed ? 'checked' : ''} />
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-1">
                    <span>${getPriorityIcon(t.priority)}</span>
                    <span>${getCategoryIcon(t.category)}</span>
                    <span class="text-xs bg-slate-100 px-2 py-1 rounded text-slate-600 capitalize">${t.category}</span>
                  </div>
                  <h3 class="font-semibold ${t.completed ? 'line-through text-slate-400' : 'text-slate-800'}">${escapeHtml(t.title)}</h3>
                  <div class="flex items-center gap-3 mt-1 text-sm text-slate-500">
                    <span>#${t.id}</span>
                    ${t.dueDate ? `<span>ğŸ“… ${formatDate(t.dueDate)}</span>` : ''}
                  </div>
                </div>
              </div>
              <button class="del text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg">ğŸ—‘ï¸</button>
            </div>
          </div>
        `;
      }

      function escapeHtml(s) {
        return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
      }

      async function load() {
        const res = await fetch('/api/tasks');
        allTasks = await res.json();
        applyFilter();
      }

      function applyFilter() {
        const searchTerm = document.getElementById('searchTask').value.toLowerCase().trim();
        const priorityFilter = document.getElementById('filterPriority').value;
        const categoryFilter = document.getElementById('filterCategory').value;
        
        filteredTasks = allTasks.filter(task => {
          const matchesSearch = task.title.toLowerCase().includes(searchTerm);
          const matchesPriority = !priorityFilter || task.priority === priorityFilter;
          const matchesCategory = !categoryFilter || task.category === categoryFilter;
          return matchesSearch && matchesPriority && matchesCategory;
        });
        
        render();
        updateStats();
      }

      function render() {
        const el = document.getElementById('tasks');
        if (!filteredTasks.length) {
          el.innerHTML = '<div class="text-center py-8 text-slate-500"><p>No tasks found</p></div>';
        } else {
          el.innerHTML = filteredTasks.map(taskHtml).join('');
        }

        document.querySelectorAll('.cb').forEach(cb => cb.addEventListener('change', async (e) => {
          const id = e.target.closest('[data-id]').dataset.id;
          await fetch('/api/tasks/' + id, { 
            method: 'PUT', 
            headers: {'Content-Type':'application/json'}, 
            body: JSON.stringify({ completed: e.target.checked }) 
          });
          load();
        }));

        document.querySelectorAll('.del').forEach(btn => btn.addEventListener('click', async (e) => {
          const id = e.target.closest('[data-id]').dataset.id;
          await fetch('/api/tasks/' + id, { method: 'DELETE' });
          load();
        }));
      }

      function updateStats() {
        const total = allTasks.length;
        const completed = allTasks.filter(t => t.completed).length;
        const pending = total - completed;
        const showing = filteredTasks.length;
        
        const priorityStats = {
          high: allTasks.filter(t => t.priority === 'high' && !t.completed).length,
          medium: allTasks.filter(t => t.priority === 'medium' && !t.completed).length,
          low: allTasks.filter(t => t.priority === 'low' && !t.completed).length
        };
        
        const overdue = allTasks.filter(t => {
          if (!t.dueDate || t.completed) return false;
          return new Date(t.dueDate) < new Date();
        }).length;
        
        document.getElementById('taskStats').innerHTML = `
          <div class="grid grid-cols-4 gap-4 text-sm">
            <div class="bg-white rounded-lg p-3 text-center border">
              <div class="text-xl font-bold text-blue-600">${total}</div>
              <div class="text-slate-600">Total</div>
            </div>
            <div class="bg-white rounded-lg p-3 text-center border">
              <div class="text-xl font-bold text-green-600">${completed}</div>
              <div class="text-slate-600">Done</div>
            </div>
            <div class="bg-white rounded-lg p-3 text-center border">
              <div class="text-xl font-bold text-orange-600">${pending}</div>
              <div class="text-slate-600">Pending</div>
            </div>
            <div class="bg-white rounded-lg p-3 text-center border">
              <div class="text-xl font-bold ${overdue > 0 ? 'text-red-600' : 'text-slate-400'}">${overdue}</div>
              <div class="text-slate-600">Overdue</div>
            </div>
          </div>
          <div class="mt-2 text-center text-slate-600 text-sm">
            ğŸ”´ ${priorityStats.high} High â€¢ ğŸŸ¡ ${priorityStats.medium} Medium â€¢ ğŸŸ¢ ${priorityStats.low} Low Priority
            ${showing !== total ? ` â€¢ Showing ${showing} of ${total}` : ''}
          </div>
        `;
      }

      document.getElementById('addBtn').addEventListener('click', async () => {
        const title = document.getElementById('newTask').value.trim();
        const priority = document.getElementById('newPriority').value;
        const dueDate = document.getElementById('newDueDate').value;
        const category = document.getElementById('newCategory').value;
        
        if (!title) return;
        
        await fetch('/api/tasks', { 
          method: 'POST', 
          headers: {'Content-Type':'application/json'}, 
          body: JSON.stringify({ title, priority, dueDate: dueDate || null, category }) 
        });
        
        document.getElementById('newTask').value = '';
        document.getElementById('newDueDate').value = '';
        load();
      });

      // Search and filter functionality
      document.getElementById('searchTask').addEventListener('input', applyFilter);
      document.getElementById('filterPriority').addEventListener('change', applyFilter);
      document.getElementById('filterCategory').addEventListener('change', applyFilter);

      // Allow Enter to submit
      document.getElementById('newTask').addEventListener('keydown', (e) => { 
        if (e.key === 'Enter') document.getElementById('addBtn').click(); 
      });

      load();
    </script>
  </body>
</html>
